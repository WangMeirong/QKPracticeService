<?xml version="1.0" encoding="UTF-8" ?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" ><mapper namespace="com.qk.practice.dao.IExamDao">	<resultMap type="Exam" id="ExamResultMap">		<id property="examId" column="exam_id"/>		<result property="subjectId" column="subject_id"/>		<result property="code" column="code"/>		<result property="title" column="title"/>		<result property="decription" column="description"/>		<result property="duration" column="duration"/>		<result property="isPublic" column="is_public"/>		<result property="isDelete" column="is_delete"/>		<result property="createdTime" column="created_time"/>		<result property="lastModifiedBy" column="last_modified_by"/>		<result property="lastModifiedTime" column="last_modified_time"/>		<result property="score" column="score"/>		<association property="subject" select="com.qk.practice.dao.ISubjectDao.getSubjectById" column="subject_id" javaType="Subject"/>		<collection property="practices" select="com.qk.practice.dao.IPracticeDao.getPracticeByExamId" column="exam_id" ofType="Practice"/>		<collection property="tags" select="com.qk.practice.dao.ITagDao.getTagByExamId" column="exam_id" ofType="Tag"></collection>	</resultMap>		<resultMap id="ExamTagResultMap" type="ExamTag" >		<id property="ExamTagId" column="exam_tag_id"/>		<result property="examId" column="exam_id"/>		<result property="tagId" column="tag_id"/>		<result property="isDelete" column="is_delete"/>		<result property="createdTime" column="created_time"/>		<result property="lastModifiedBy" column="last_modified_by"/>		<result property="lastModifiedTime" column="last_modified_time"/>	</resultMap>		<sql id="Exam_Column_List">		exam_id,subject_id,code,title,description,duration,is_public,		is_delete,created_time,last_modified_by,last_modified_time	</sql>		<select id="getExamById" resultMap="ExamResultMap" parameterType="java.lang.String">		select <include refid="Exam_Column_List"></include>		from exam		where is_delete = 'N' and exam_id = #{examId}	</select>		<select id="getAllExams" resultMap="ExamResultMap">		select e.exam_id,e.subject_id,e.code,e.title,e.description,e.duration,e.is_public,			   e.is_delete,e.created_time,e.last_modified_by,e.last_modified_time		from exam e, subject s		where e.subject_id = s.subject_id and e.is_delete = 'N'	</select>		<select id="getExams" resultMap="ExamResultMap" parameterType="Exam">		select e.exam_id,e.subject_id,e.code,e.title,e.description,e.duration,e.is_public,			   e.is_delete,e.created_time,e.last_modified_by,e.last_modified_time		from exam e, subject s		where e.subject_id = s.subject_id and e.is_delete = 'N'		<if test="examId != null" >	    	and e.exam_id = #{examId}	    </if>	    <if test="code != null" >	    	and e.code = #{code}	    </if>	    <if test="title != null" >	    	and e.title like '%${title}%'	    </if>	    <if test="subjectId != null" >	    	and s.name = #{subjectId}	    </if>	</select>		<select id="getExamTagsByExamId" parameterType="java.lang.String" resultMap="ExamTagResultMap">		select exam_tag_id, exam_id, tag_id, is_delete		from exam_tag		where exam_id = #{examId}	</select>		<select id="getExamPracticeByExamId" parameterType="java.lang.String" resultType="ExamPractice">		select exam_practice_id, exam_id,practice_id, is_delete,order		from exam_practice		where exam_id = #{examId}	</select>		<update id="deleteExamById" parameterType="java.lang.String">		update exam set is_delete = 'Y'			   last_modified_by = #{lastModifiedBy},	    	   last_modified_time = unix_timestamp() * 1000	    where is_delete = 'N' and exam_id = #{examId};	    	    update exam_tag set is_delete = 'Y'		       last_modified_by = #{lastModifiedBy},	           last_modified_time = unix_timestamp() * 1000		where is_delete = 'N' and exam_id = #{examId};	    	    update exam_practice set 			   is_delete = 'Y',			   last_modified_by = #{lastModifiedBy},			   last_modified_time = unix_timestamp() * 1000		where is_delete='N' and exam_id = #{examId}	</update>		<update id="deleteExamsById" parameterType="java.util.List">		<foreach collection="list" item="item" index="index" separator=";" >			update exam set is_delete = 'Y'				   last_modified_by = #{item.lastModifiedBy},		    	   last_modified_time = unix_timestamp() * 1000		    where is_delete = 'N' and exam_id = #{item.examId};		    		    update exam_tag set is_delete = 'Y'			       last_modified_by = #{item.lastModifiedBy},		           last_modified_time = unix_timestamp() * 1000			where is_delete = 'N' and exam_id = #{item.examId};		    		    update exam_practice set 				   is_delete = 'Y',				   last_modified_by = #{item.lastModifiedBy},				   last_modified_time = unix_timestamp() * 1000			where is_delete='N' and exam_id = #{item.examId}		</foreach>	</update>		<update id="deleteExamPracticesByExamId" parameterType="ExamPractice">		update exam_practice set 		is_delete = 'Y',		last_modified_by = #{lastModifiedBy},	    last_modified_time = unix_timestamp() * 1000		where exam_id = #{examId} and is_delete='N'	</update>		<update id="deleteExamPracticeByPracticeId" parameterType="ExamPractice">		<if test="examId != null">			update exam_practice set			is_delete = 'Y',			last_modified_by = #{lastModifiedBy},	    	last_modified_time = unix_timestamp() * 1000			where exam_id = #{examId} and is_delete='N'			<if test="practiceId != null">				practice_id = #{practiceId}			</if>		</if>	</update>		<update id="deleteExamTagsByExamId" parameterType="ExamTag">		update exam_tag set is_delete = 'Y'		       last_modified_by = #{lastModifiedBy},	           last_modified_time = unix_timestamp() * 1000		where is_delete = 'N' and exam_id = #{examId}	</update>		<update id="updateExamById" parameterType="Exam">		update exam	    set code = #{code},	        title = #{title},	        description = #{description},	        is_public = #{isPublic},	        duration = #{duration},	        score = #{score}	        last_modified_by = #{lastModifiedBy},	        last_modified_time = unix_timestamp() * 1000	        <if test="subject != null and subject.subjectId != null">	        	,subject_Id = #{subject.subjectId}	        </if>	      where exam_id = #{examId}	  </update>	  	  <update id="updateExamPractices" parameterType="java.util.List">	  	<foreach collection="list" item="item" index="index" separator=";" >  	  		<if test="item.examId != null and item.examId != '' and item.practiceId != null and item.practiceId != ''">			  	update exam_practice set is_delete = #{item.isDelete}, 			  		   order = #{item.order},			  		   score = #{item.score},			  		   last_modified_by = #{item.lastModifiedBy},			           last_modified_time = unix_timestamp() * 1000			  	where 1=1			  	<if test="item.examId != null and item.examId != ''">			  		and exam_id = #{item.examId} 			  	</if>			  	<if test="item.practiceId != null and item.practiceId != ''">			    	and practice_id = #{item.practiceId}			    </if>		    </if>        </foreach> 	  </update>	  	  <update id="updateExamTags" parameterType="java.util.List" >	  	<foreach collection="list" item="item" index="index" separator=";" >  	  		<if test="item.examId != null and item.examId != '' and item.tagId != null and item.tagId != ''">			  	update exam_tag set is_delete = #{item.isDelete},			  		   last_modified_by = #{item.lastModifiedBy},			           last_modified_time = unix_timestamp() * 1000			  	where 1=1			  	<if test="item.examId != null and item.examId != ''">			  		and exam_id = #{item.examId} 			  	</if>			  	<if test="item.tagId != null and item.tagId != ''">			    	and tag_id = #{item.tagId}			    </if>		    </if>        </foreach> 	  </update>		  	  <!-- insert -->	  <insert id="insertExam" parameterType="Exam">	    insert into exam	    <trim prefix="(" suffix=")" suffixOverrides="," >	      <include refid="Exam_Column_List" />	    </trim>	    <trim prefix="values (" suffix=")" suffixOverrides="," >	        #{examId},	      <if test="subject != null" >	        #{subject.subjectId},	      </if>	      #{code},#{title},#{description},#{duration},#{statusId},'N', unix_timestamp() * 1000,#{lastModifiedBy},unix_timestamp() * 1000	    </trim>	  </insert>	  	  <insert id="insertExamPractice" parameterType="ExamPractice">	  	insert exam_practice (exam_pratice_id,exam_id,practice_id,score,order,is_delete,created_time,last_modified_by,last_modified_time)	    values(#{examPraticeId},#{examId},#{practiceId},#{score},#{order},'N',unix_timestamp() * 1000,#{lastModifiedBy},unix_timestamp() * 1000)	  </insert>	  	  <insert id="insertExamPractices" parameterType="java.util.List">  		<selectKey resultType="java.lang.String" keyProperty="examPraticeId" order="BEFORE">              SELECT UUID()        </selectKey>          insert exam_practice (exam_pratice_id,exam_id,practice_id,score,order,is_delete,created_time,last_modified_by,last_modified_time)        values          <foreach collection="list" item="item" index="index" separator="," >              (#{item.examPraticeId},#{item.examId},#{item.practiceId},#{item.score},#{item.order},'N',unix_timestamp() * 1000,#{item.lastModifiedBy},unix_timestamp() * 1000)         </foreach>       </insert>              <insert id="insertExamTag" parameterType="ExamTag">      	insert into exam_tag (exam_tag_id,tag_id, exam_id, is_delete,created_time,last_modified_by,last_modified_time)      	values (#{examTagId},#{tagId},#{examId},'N',unix_timestamp() * 1000,#{lastModifiedBy},unix_timestamp() * 1000)      </insert>            <insert id="insertExamTags" parameterType="java.util.List">  <!-- 		<selectKey resultType="java.lang.String" keyProperty="practiceTagId" order="BEFORE">   --><!--             SELECT UUID() --><!--         </selectKey>   -->        insert exam_tag (exam_tag_id,tag_id, exam_id, is_delete,created_time,last_modified_by,last_modified_time)        values          <foreach collection="list" item="item" index="index" separator="," >              (#{item.examTagId},#{item.tagId},#{item.examId},'N',unix_timestamp() * 1000,#{item.lastModifiedBy},unix_timestamp() * 1000)         </foreach>       </insert> </mapper>