<?xml version="1.0" encoding="UTF-8" ?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" ><mapper namespace="com.qk.practice.dao.IPracticeDao">	<resultMap id="PracticeResultMap" type="Practice" >		<id property="practiceId" column="practice_id"/>		<result property="code" column="code"/>		<result property="subjectId" column="subject_id"/>		<result property="answerId" column="answer_id"/>		<result property="title" column="title"/>		<result property="description" column="description"/>		<result property="attachment" column="attachment"/>		<result property="isPublic" column="is_public"/>		<result property="statusId" column="status_id"/>		<result property="isDelete" column="is_delete"/>		<result property="createdTime" column="created_time"/>		<result property="lastModifiedBy" column="last_modified_by"/>		<result property="lastModifiedTime" column="last_modified_time"/>		<association property="subject" select="com.qk.practice.dao.ISubjectDao.getSubjectById" column="subject_id" javaType="Subject"/>		<association property="answer" select="com.qk.practice.dao.IanswerDao.getanswerById" column="answer_id" javaType="answer"/>		<collection property="tags" select="com.qk.practice.dao.ITagDao.getTagByPracticeId" column="practice_id" ofType="Tag"></collection>	</resultMap>	<sql id="Practice_Column_List" >	    practice_id, subject_id, answer_id, code, title,description,attachment,is_public,status_id,is_delete,created_time,last_modified_by,last_modified_time	</sql>		<!-- select -->	<select id="getPracticeById" resultMap="PracticeResultMap" parameterType="java.lang.String" >	    select <include refid="Practice_Column_List" />	    from practice	    where is_delete = 'N'	    and practice_id = #{practiceId}	 </select>	 		 <select id="getPracticeByExamId" resultMap="PracticeResultMap" parameterType="java.lang.String">	 	select p.practice_id, p.subject_id, p.answer_id, p.code, p.title,p.description,	    	   p.attachment,p.is_public,p.status_id,p.created_time,p.last_modified_by,p.last_modified_time	    from practice p, exam_practice ep	    where p.practice_id = ep.practice_id	    and ep.exam_id = #{exam_id}	 </select>	 	 <select id="getAllPractices" resultMap="PracticeResultMap">	 	select p.practice_id, p.subject_id, p.answer_id, p.code, p.title,p.description,	    	   p.attachment,p.is_public,p.status_id,p.created_time,p.last_modified_by,p.last_modified_time	    from practice p, subject s	    where p.is_delete = 'N' and p.subject_id = s.subject_id 	 </select>	 <select id="getPractices" resultMap="PracticeResultMap">	    select p.practice_id, p.subject_id, p.answer_id, p.code, p.title,p.description,	    	   p.attachment,p.is_public,p.status_id,p.created_time,p.last_modified_by,p.last_modified_time	    from practice p, subject s	    where p.is_delete = 'N' and p.subject_id = s.subject_id 	    <if test="practice.practiceId != null" >	    	and p.practice_id = #{practice.practiceId}	    </if>	    <if test="practice.code != null" >	    	and p.code = #{practice.code}	    </if>	    <if test="practice.title != null" >	    	and p.title like '%${practice.title}%'	    </if>	    <if test="practice.subject != null and practice.subject.name != null" >	    	and s.name = #{practice.subject.name}	    </if>	    <if test="practice.statusId != null" >	    	and p.status_id = #{practice.statusId}	    </if>	 </select>	 	 <select id="getPracticeTagsById" resultType="PracticeTag" parameterType="java.lang.String">	 	select practice_id, tag_id, is_delete	    from practice_tag	    where p.practice_id = #{practiceId}	 </select>	 	 <!-- delete --><!-- 	 <delete id="deletePracticeById" parameterType="java.lang.String" > --><!-- 	    delete from practice --><!-- 	    where practice_id = #{practiceId,jdbcType=VARCHAR} --><!-- 	 </delete> -->		  <!-- update -->	  <update id="deletePracticeById" parameterType="Practice" >	  	update practice set is_delete = 'Y' 	  		   last_modified_by = #{lastModifiedBy},	           last_modified_time = unix_timestamp() * 1000	  	where practice_id = #{practiceId}	  </update>	  <update id="deletePracticeTagById" parameterType="PracticeTag" >	  	update practice_tag set is_delete = 'Y' 	  		   last_modified_by = #{lastModifiedBy},	           last_modified_time = unix_timestamp() * 1000	  	where practice_id = #{practiceId}	  </update>	  	  	  <update id="updatePracticeById">	    update practice	    set code = #{practice.code},	        title = #{practice.title},	        description = #{practice.description},	        attachment = #{practice.attachment},	        is_public = #{practice.isPublic},	        status_id = #{practice.statusId},	        last_modified_by = #{practice.lastModifiedBy},	        last_modified_time = unix_timestamp() * 1000	        <if test="practice.subject != null and practice.subject.subjectId != null">	        	,subject_Id = #{practice.subject.subjectId}	        </if>	        <if test="practice.answer != null and practice.answer.answerId != null">	        	,answer_Id = #{practice.answer.answerId}	        </if>	    where practice_id = #{practice.practiceId}	  </update>	  	  <!-- insert -->	 <insert id="insertPractice" parameterType="Practice">	    insert into practice	    <trim prefix="(" suffix=")" suffixOverrides="," >	      <include refid="Practice_Column_List" />	    </trim>	    <trim prefix="values (" suffix=")" suffixOverrides="," >	        #{practiceId},	        #{subjectId},	      <if test="answer != null" >	        #{answer.answerId},	      </if>	      #{code}, #{title},#{description},#{attachment},#{isPublic},#{statusId},'N',unix_timestamp() * 1000,#{lastModifiedBy},unix_timestamp() * 1000	    </trim>	  </insert>	  <insert id="insertPracticeTag" parameterType="PracticeTag">      	insert into practice_tag (practice_tag_id,tag_id, practice_id, is_delete,created_time,last_modified_by,last_modified_time)      	values (#{practiceTagId},#{tagId},#{practiceId},'N',unix_timestamp() * 1000,#{lastModifiedBy},unix_timestamp() * 1000)      </insert>            <insert id="insertPracticeTags" parameterType="java.util.List">  <!-- 		<selectKey resultType="java.lang.String" keyProperty="practiceTagId" order="BEFORE">   --><!--             SELECT UUID() --><!--         </selectKey>   -->        insert practice_tag (practice_tag_id,tag_id, practice_id, is_delete,created_time,last_modified_by,last_modified_time)        values          <foreach collection="list" item="item" index="index" separator="," >              (#{practiceTagId},#{tagId},#{practiceId},'N',unix_timestamp() * 1000,#{lastModifiedBy},unix_timestamp() * 1000)         </foreach>       </insert>  </mapper>