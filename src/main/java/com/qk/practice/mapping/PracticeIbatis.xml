<?xml version="1.0" encoding="UTF-8" ?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" ><mapper namespace="com.qk.practice.dao.IPracticeDao">	<resultMap id="PracticeResultMap" type="Practice" >		<id property="practiceId" column="practice_id"/>		<result property="code" column="code"/>		<result property="subjectId" column="subject_id"/>		<result property="answerId" column="answer_id"/>		<result property="title" column="title"/>		<result property="description" column="description"/>		<result property="attachment" column="attachment"/>		<result property="isPublic" column="is_public"/>		<result property="isDelete" column="is_delete"/>		<result property="createdTime" column="created_time"/>		<result property="lastModifiedBy" column="last_modified_by"/>		<result property="lastModifiedTime" column="last_modified_time"/>		<result property="score" column="score"/>		<result property="order" column="order"/>		<association property="subject" select="com.qk.practice.dao.ISubjectDao.getSubjectById" column="subject_id" javaType="Subject"/>		<association property="answer" select="com.qk.practice.dao.IAnswerDao.getAnswerById" column="answer_id" javaType="Answer"/>		<collection property="tags" select="com.qk.practice.dao.ITagDao.getTagByPracticeId" column="practice_id" ofType="Tag"></collection>	</resultMap>		<resultMap id="PracticeTagResultMap" type="PracticeTag" >		<id property="PracticeTagId" column="practice_tag_id"/>		<result property="practiceId" column="practice_id"/>		<result property="tagId" column="tag_id"/>		<result property="isDelete" column="is_delete"/>		<result property="createdTime" column="created_time"/>		<result property="lastModifiedBy" column="last_modified_by"/>		<result property="lastModifiedTime" column="last_modified_time"/>	</resultMap>	<sql id="Practice_Column_List" >	    practice_id, subject_id, answer_id, code, title,description,attachment,is_public,is_delete,created_time,last_modified_by,last_modified_time	</sql>		<!-- select -->	<select id="getPracticeById" resultMap="PracticeResultMap" parameterType="java.lang.String" >	    select <include refid="Practice_Column_List" />	    from practice	    where is_delete = 'N'	    and practice_id = #{practiceId}	 </select>	 		 <select id="getPracticeByExamId" resultMap="PracticeResultMap" parameterType="java.lang.String">	 	select p.practice_id, p.subject_id, p.answer_id, p.code, p.title,p.description,	    	   p.attachment,p.is_public,p.created_time,p.last_modified_by,p.last_modified_time,ep.score,ep.order	    from practice p, exam_practice ep	    where p.practice_id = ep.practice_id	    and ep.exam_id = #{exam_id}	    order by ep.order asc	 </select>	 	 <select id="getAllPractices" resultMap="PracticeResultMap">	 	select p.practice_id, p.subject_id, p.answer_id, p.code, p.title,p.description,	    	   p.attachment,p.is_public,p.created_time,p.last_modified_by,p.last_modified_time	    from practice p, subject s	    where p.is_delete = 'N' and p.subject_id = s.subject_id 	 </select>	 <select id="getPractices" resultMap="PracticeResultMap">	    select p.practice_id, p.subject_id, p.answer_id, p.code, p.title,p.description,	    	   p.attachment,p.is_public,p.created_time,p.last_modified_by,p.last_modified_time	    from practice p, subject s	    where p.is_delete = 'N' and p.subject_id = s.subject_id 	    <if test="practice.practiceId != null" >	    	and p.practice_id = #{practice.practiceId}	    </if>	    <if test="practice.code != null" >	    	and p.code = #{practice.code}	    </if>	    <if test="practice.title != null and practice.title != ''" >	    	and p.title like '%${practice.title}%'	    </if>	    <if test="practice.subjectId != null and practice.subjectId != ''" >	    	and s.subject_id = #{practice.subjectId}	    </if>	 </select>	 	 <select id="getPracticeTagsById" resultMap="PracticeTagResultMap" parameterType="java.lang.String">	 	select practice_id, tag_id, is_delete	    from practice_tag	    where practice_id = #{practiceId}	 </select>	 	  <!-- update -->	  <update id="deletePracticeById" parameterType="Practice" >	  	update practice set is_delete = 'Y',	  		   last_modified_by = #{lastModifiedBy},	           last_modified_time = unix_timestamp() * 1000	  	where practice_id = #{practiceId}	  	and is_delete = 'N';	  	update answer set is_delete = 'Y',	  		   last_modified_by = #{lastModifiedBy},	           last_modified_time = unix_timestamp() * 1000	  	where answer_id = (select answer_id from practice where practice_id =#{practiceId})	  	and is_delete = 'N';	  	update practice_tag set is_delete = 'Y',	  		   last_modified_by = #{lastModifiedBy},	           last_modified_time = unix_timestamp() * 1000	  	where practice_id = #{practiceId}	  	and is_delete = 'N'	  </update>	  	  <update id="deletePracticesById" parameterType="java.util.List" >	  	<foreach collection="list" item="item" index="index" separator=";" >		  	update practice set is_delete = 'Y',		  		   last_modified_by = #{item.lastModifiedBy},		           last_modified_time = unix_timestamp() * 1000		  	where practice_id = #{item.practiceId}		  	and is_delete = 'N';		  			  	update answer set is_delete = 'Y',		  		   last_modified_by = #{item.lastModifiedBy},		           last_modified_time = unix_timestamp() * 1000		  	where answer_id = (select answer_id from practice where practice_id = #{item.practiceId})		  	and is_delete = 'N';		  			  	update practice_tag set is_delete = 'Y',		  		   last_modified_by = #{item.lastModifiedBy},		           last_modified_time = unix_timestamp() * 1000		  	where practice_id = #{item.practiceId}		  	and is_delete = 'N'		</foreach>	  </update>	  <update id="deletePracticeTagById" parameterType="PracticeTag" >	  	update practice_tag set is_delete = 'Y',	  		   last_modified_by = #{lastModifiedBy},	           last_modified_time = unix_timestamp() * 1000	  	where practice_id = #{practiceId}	  	and is_delete = 'N'	  </update>	  	  <update id="updatePracticeTags" parameterType="java.util.List" >	  	<foreach collection="list" item="item" index="index" separator=";" >  	  		<if test="item.practiceId != null and item.practiceId != '' and item.tagId != null and item.tagId != ''">			  	update practice_tag set is_delete = #{item.isDelete},			  		   last_modified_by = #{item.lastModifiedBy},			           last_modified_time = unix_timestamp() * 1000			  	where 1=1			  	<if test="item.practiceId != null and item.practiceId != ''">			  		and practice_id = #{item.practiceId} 			  	</if>			  	<if test="item.tagId != null and item.tagId != ''">			    	and tag_id = #{item.tagId}			    </if>		    </if>        </foreach> 	  </update>	 	  	  <update id="updatePracticeById">	    update practice	    set 	        description = #{practice.description},	        attachment = #{practice.attachment},	        is_public = #{practice.isPublic},	        last_modified_by = #{practice.lastModifiedBy},	        last_modified_time = unix_timestamp() * 1000,	        subject_Id = #{practice.subjectId}	    where practice_id = #{practice.practiceId}	  </update>	  	  <!-- insert -->	 <insert id="insertPractice" parameterType="Practice">	    insert into practice	    <trim prefix="(" suffix=")" suffixOverrides="," >	      <include refid="Practice_Column_List" />	    </trim>	    <trim prefix="values (" suffix=")" suffixOverrides="," >	        #{practiceId},	        #{subjectId},	      <if test="answer != null and answer != ''" >	        #{answer.answerId},	      </if>	      #{code}, #{title},#{description},#{attachment},#{isPublic},'N',unix_timestamp() * 1000,#{lastModifiedBy},unix_timestamp() * 1000	    </trim>	  </insert>	  <insert id="insertPracticeTag" parameterType="PracticeTag">      	insert into practice_tag (practice_tag_id,tag_id, practice_id, is_delete,created_time,last_modified_by,last_modified_time)      	values (#{practiceTagId},#{tagId},#{practiceId},'N',unix_timestamp() * 1000,#{lastModifiedBy},unix_timestamp() * 1000)      </insert>            <insert id="insertPracticeTags" parameterType="java.util.List">  <!-- 		<selectKey resultType="java.lang.String" keyProperty="practiceTagId" order="BEFORE">   --><!--             SELECT UUID() --><!--         </selectKey>   -->        insert practice_tag (practice_tag_id,tag_id, practice_id, is_delete,created_time,last_modified_by,last_modified_time)        values          <foreach collection="list" item="item" index="index" separator="," >              (#{item.practiceTagId},#{item.tagId},#{item.practiceId},'N',unix_timestamp() * 1000,#{item.lastModifiedBy},unix_timestamp() * 1000)         </foreach>       </insert>  </mapper>